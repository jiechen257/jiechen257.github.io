{"title":"SSL建立的三个随机数作用","date":"2022-05-27T22:01:01.000Z","date_formatted":{"ll":"May 27, 2022","L":"05/27/2022","MM-DD":"05-27"},"link":"2022/05/27/SSL建立的三个随机数作用","comments":true,"tags":["ssl"],"categories":["cs-basics"],"updated":"2023-07-11T08:54:19.192Z","content":"<h2 id=\"概述\">概述<a title=\"#概述\" href=\"#概述\"></a></h2>\n<p>首先再重温下 <code>TLS四次握手</code> 的过程：</p>\n<ol>\n<li>客户端向服务端发送协议版本号、一个随机数和可以使用的加密方法</li>\n<li>服务端接受后，确认加密的方法，向客户端发送一个随机数和自己数字证书</li>\n<li>客户端首先检查数字证书是否有效，如果有效，就再生成一个随机数，用数字证书提供的公钥加密再发给服务端，同时提供一个前面所有内容的hash值发给服务端以供校验</li>\n<li>服务端接收后，使用自己的私钥对数据解密，同时也发一个前面所有内容的hash值供客户端校验</li>\n</ol>\n<p>双方再有了三个随机数之后，按照之前约定的加密方法，使用三个随机数生成一个密钥，之后双方通信，就是用这个密钥对数据加密后再传输</p>\n<p>其中有用到三个随机数，用来做什么，为什么是三个？</p>\n<h2 id=\"分析\">分析<a title=\"#分析\" href=\"#分析\"></a></h2>\n<p>具体过程，图示如下（1-9）：<br>\n<img src=\"http://cdn.becase.top/20220530170531.png\" alt=\"\" loading=\"lazy\"></p>\n<p>其中建立 SSL 的三个随机数分别是：</p>\n<ul>\n<li>ClientHello 中存在的一个随机数，令为 A</li>\n<li>ServerHello 中存在的一个随机数，令为 B</li>\n<li>ClientKeyExchange中的随机密码串</li>\n</ul>\n<h2 id=\"随机数的作用\">随机数的作用<a title=\"#随机数的作用\" href=\"#随机数的作用\"></a></h2>\n<p>先看第三个随机数，这是一个被称为 <code>Pre-master secret</code> 的随机密码串，由加密算法提供</p>\n<p>当客户端生成了 <code>Pre-master secret</code> 后，结合原来的 A 和 B 使用算法算出一个 <code>master secret</code> ，根据这个推到出 <code>hash secret</code>和<code>session secret</code>，这两个结果完全是依据三个随机数推到出来的，只有双方知道</p>\n<p>通信：</p>\n<ul>\n<li>双方使用对称加密算法进行加密，用hash secret对HTTP报文做一次运算生成一个MAC，附在HTTP报文的后面，然后用session-secret加密所有数据（HTTP+MAC），然后发送。</li>\n<li>接收方则先用session-secret解密数据，然后得到HTTP+MAC，再用相同的算法计算出自己的MAC，如果两个MAC相等，证明数据没有被篡改</li>\n</ul>\n<blockquote>\n<p>MAC(Message Authentication Code)称为报文摘要，能够查知报文是否遭到篡改，从而保护报文的完整性</p>\n</blockquote>\n<h2 id=\"为什么是三个\">为什么是三个<a title=\"#为什么是三个\" href=\"#为什么是三个\"></a></h2>\n<p>SSL协议默认不信任 <code>每个主机都能产生完全随机的随机数</code>， 如果随机数不随机，那么 <code>pre-master secret</code> 就可能被破解（因为密钥交换算法是公开的算法），所以必须引入新的随机因素，那么客户端和服务器加上pre-master secret三个随机数一同生成的密钥就不容易被猜出了，一个伪随机可能完全不随机，可是是三个伪随机就十分接近随机了，每增加一个自由度，随机性增加的可不是一</p>\n<h2 id=\"参考\">参考<a title=\"#参考\" href=\"#参考\"></a></h2>\n<p><a href=\"https://blog.csdn.net/qq_31442743/article/details/116199453\" target=\"_blank\">HTTPS通信的过程的三个随机数的作用</a></p>\n<p><a href=\"https://www.csdn.net/tags/MtTaEg2sMjM0NjA5LWJsb2cO0O0O.html\" target=\"_blank\">为什么是三个随机数</a></p>\n<p><a href=\"https://cloud.tencent.com/developer/article/1415674\" target=\"_blank\"> SSL_ 随机数_的作用</a></p>\n","prev":{"title":"TS类型体操刷题tips","link":"2022/08/27/TS类型体操刷题tips"},"next":{"title":"状态管理工具的演变","link":"2022/05/27/状态管理工具的演变"},"plink":"https://becase.top/2022/05/27/SSL建立的三个随机数作用/","toc":[{"id":"概述","title":"概述","index":"1"},{"id":"分析","title":"分析","index":"2"},{"id":"随机数的作用","title":"随机数的作用","index":"3"},{"id":"为什么是三个","title":"为什么是三个","index":"4"},{"id":"参考","title":"参考","index":"5"}],"reading_time":"765 words in 5 min"}